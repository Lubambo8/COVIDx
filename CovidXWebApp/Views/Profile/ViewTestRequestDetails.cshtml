@{
    Layout = "~/Views/Shared/CovidX/Dashboard.cshtml";

}

@model TestRequestViewModel
@inject IPatientServices _patientService
@inject UserManager<EFCoreIdentityUser> _userManager

@{
    string headerText = "Request a Test Demo";

    // create a list of the active states and inactive states
    var activeTestStatus = new TestRequestStatus[] { TestRequestStatus.New, TestRequestStatus.Assigned, TestRequestStatus.Scheduled, TestRequestStatus.AtLab };
    var inactiveTestStatus = new TestRequestStatus[] { TestRequestStatus.Cancelled, TestRequestStatus.Closed, TestRequestStatus.Performed };

    var user = await _userManager.GetUserAsync(User);

    var patient = _patientService.GetPatientDetail(user.Id);

    var requestDetails = _patientService.GetTestRequests(user.Id);
}

@section PageHeader{

    <partial name="CovidX/Page/_Header" model="headerText" />
}

<!-- 12 COLUMN ROW START -->
<div class="row justify-content-center">
    <partial name="CovidX/Page/_Alert" model="Model.Alert" />
</div>

<!-- 12 COLUMN ROW START -->
<div class="row justify-content-center">
    <!-- ADD CARD HERE -->
    <!-- 6 COLUMN CARD START -->
    <div class="col-md-12">
        <div class="card">
            <!-- CARD HEADER START -->
            <div class="card-header border-0">
                <h3 class="card-title">Test request for @patient.FirstName @patient.LastName</h3>
                <!-- CARD TOOLS START -->
                <div class="card-tools">
                    <!-- ADD CARD TOOLS HERE -->
                    <partial name="CovidX/Card/Tool/_collapse" />
                    <partial name="CovidX/Card/Tool/_maximize" />

                </div>
                <!-- CARD TOOLS END -->
            </div>
            <!-- CARD HEADER END -->
            <!-- CARD BODY START -->
            <div class="card-body table-responsive p-0">
                <!-- ADD CONTENT HERE -->
                <table class="table table-striped table-valign-middle">
                    <thead>
                        <tr>
                            <!-- TABLE HEADERS -->
                            <th>Patient</th>
                            <th>Nurse</th>
                            <th>Test Status</th>
                            <th>Test Location</th>
                            <th>Test Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- TABLE CONTENT ROW -->
                        @foreach (var detail in requestDetails)
                        {
                            <tr>
                                <td>
                                    @detail.PatientFullName
                                </td>
                                <td>
                                    @detail.NurseFullName
                                </td>
                                <td>
                                    @if (detail.IsActive)
                                    {
                                        @switch (detail.Status)
                                        {
                                            case TestRequestStatus.New:
                                                <span class="badge bg-purple">New</span>
                                                break;
                                            case TestRequestStatus.Cancelled:
                                                <span class="badge bg-danger">Canceled</span>
                                                break;
                                            case TestRequestStatus.Assigned:
                                                <span class="badge bg-blue">Assigned</span>
                                                break;
                                            case TestRequestStatus.Scheduled:
                                                <span class="badge bg-green">Scheduled</span>
                                                break;
                                            case TestRequestStatus.Performed:
                                                <span class="badge bg-lime">Performed</span>
                                                break;
                                            case TestRequestStatus.AtLab:
                                                <span class="badge bg-yellow">At lab</span>
                                                break;
                                            case TestRequestStatus.Closed:
                                                <span class="badge bg-fuchsia">Closed</span>
                                                break;
                                            default:
                                                break;
                                        }
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary">None</span>
                                    }
                                </td>
                                <td>
                                    @detail.TestLocation
                                </td>
                                <td>
                                    <small class="text-success mr-1">
                                        <i class="fas fa-calendar-alt"></i>
                                    </small>
                                    @detail.TestDate
                                </td>
                                <td>
                                    <form asp-controller="Patient">
                                        <div class="row">
                                            <input type="hidden" asp-for="PatientId" value="@detail.RequestedByID" />
                                            <input type="hidden" asp-for="DependentId" value="@detail.RequestedForID" />
                                            <input type="hidden" asp-for="TestRequestID" value="@detail.TestRequestID" />
                                            <input type="hidden" asp-for="SuburbId" value="@detail.SuburbID" />
                                            @if (detail.IsActive)
                                            {
                                                <div class="col">
                                                    <button asp-action="Book" type="submit" class="btn btn-outline-primary btn-block" disabled>Request</button>
                                                </div>
                                                <div class="col">
                                                    <button asp-action="Cancel" type="submit" class="btn btn-outline-secondary btn-block">Cancel</button>
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="col">
                                                    <button asp-action="Book" type="submit" class="btn btn-outline-primary btn-block">Request</button>
                                                </div>
                                                <div class="col">
                                                    <button asp-action="Cancel" type="submit" class="btn btn-outline-secondary btn-block" disabled>Cancel</button>
                                                </div>
                                            }
                                        </div>
                                    </form>
                                </td>
                            </tr>
                        }
                        <tr>
                            <td>
                                <img src="@Url.Content("~/img/avatar/trans-reaper.png")" alt="Avatar Image" class="img-circle img-size-32 mr-2">
                                Name Surname
                            </td>
                            <td>
                                <img src="@Url.Content("~/img/avatar/female-nurse.png")" alt="Avatar Image" class="img-circle img-size-32 mr-2">
                                Name Surname
                            </td>
                            <td>
                                <span class="badge bg-danger">Canceled</span>
                            </td>
                            <td>
                                <small class="text-success mr-1">
                                    <i class="fas fa-calendar-alt"></i>
                                </small>
                                10 Oct 2:05 pm
                            </td>
                            <td>
                                <small class="text-success mr-1">
                                    <i class="fas fa-calendar-alt"></i>
                                </small>
                                14 Oct 4:00 pm
                            </td>
                            <td>
                                <form asp-controller="">
                                    <div class="row">
                                        <div class="col">
                                            <button asp-action="Register" type="submit" class="btn btn-outline-primary btn-block">Request</button>
                                        </div>
                                        <div class="col">
                                            <button asp-action="RegisterNurse" type="submit" class="btn btn-outline-secondary btn-block">Cancel</button>
                                        </div>
                                    </div>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>
            <!-- CARD BODY END -->
            <!-- CARD FOOTER START -->
            <div class="card-footer">
                <!-- ADD BUTTONS HERE -->

            </div>
            <!-- CARD FOOTER END -->
        </div>
    </div>
    <!-- 6 COLUMN CARD END -->

</div>
